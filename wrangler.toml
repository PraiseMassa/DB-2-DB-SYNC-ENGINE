name = "sync-worker"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]  # Add this line

# Queue configuration
[[queues.producers]]
queue = "db-sync-queue"
binding = "SYNC_QUEUE"

[[queues.consumers]]
queue = "db-sync-queue"
max_retries = 3
dead_letter_queue = "db-sync-dlq"

[env.production]
vars = { ENVIRONMENT = "production" }

[[env.production.queues.producers]]
queue = "db-sync-queue-prod"
binding = "SYNC_QUEUE"